<%
  current_vpc = MU.myVPC
%>
---
appname: wordpress-demo
loadbalancers: 
- name: "wordpress-demo-lb"
  region: "us-east-1"
  vpc: 
<% if $vpc_deploy_id then %>
    deploy_id: <%= $vpc_deploy_id %>
<% elsif current_vpc %>
    vpc_id: <%= current_vpc %>
<% else %>
    vpc_name: vpc
<% end %>
  ingress_rules: 
  - port: 80
    hosts: 
    - "0.0.0.0/0"
  healthcheck: 
    target: "HTTP:80/"
    unhealthy-threshold: 5
  listeners: 
   - lb-port: 80
     lb-protocol: "HTTP"
     instance-port: 80
     instance-protocol: "HTTP"
databases:
  - name: wordpress-demo-db
    engine: mysql
    size: db.t2.micro
    storage: 5
    port: 3306
servers:
- name: wordpress-demo-app
  ami_id: ami-5db4a934
  ssh_user: ubuntu
  size: m3.medium
  static_ip:
   assign_ip: true
  storage:
  - size: 70
  dependencies:
  - type: loadbalancer
    name: wordpress-demo-lb
  - type: database
    name: wordpress-demo-db
  ingress_rules:
  - port: 80
    hosts:
    - 0.0.0.0/0
  - port: 443
    hosts:
    - 0.0.0.0/0  
  run_list:
  - recipe[apache2]
  - recipe[demo::php]
  vpc:
  <% if $vpc_deploy_id then %>
    deploy_id: <%= $vpc_deploy_id %>
  <% elsif current_vpc %>
    vpc_id: <%= current_vpc %>
  <% else %>
    vpc_name: vpc
  <% end %>
admins:
- name: John Stange
  email: john.stange@eglobaltech.com
<% unless $vpc_deploy_id or current_vpc then %>
vpcs:
- name: vpc
  route-tables:
  - name: internet
    routes:
    - destination_network: 0.0.0.0/0
      gateway: "#INTERNET"
  subnets:
<% $azs.each.with_index do |az, i| %>
  - name: Subnet<%= i %>Public
    ip_block: 10.0.<%= i %>.0/24
    availability-zone: "<%= az %>"
    route-table: internet
<% end %>
<% end %>
